<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>Tecido Interativo</title>

<style>
    html, body {
        margin: 0;
        padding: 0;
        overflow: hidden;
        background: #000;
        touch-action: none; /* MUITO IMPORTANTE */
    }

    canvas {
        display: block;
    }
</style>
</head>
<body>

<canvas id="canvas"></canvas>

<script>
const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");

let w, h;
function resize() {
    w = canvas.width = window.innerWidth;
    h = canvas.height = window.innerHeight;
}
window.addEventListener("resize", resize);
resize();

// ===== CONFIGURAÇÃO DO TECIDO =====
const spacing = 18;
const cols = Math.floor(w / spacing);
const rows = Math.floor(h / spacing);

const points = [];

for (let y = 0; y < rows; y++) {
    for (let x = 0; x < cols; x++) {
        points.push({
            x: x * spacing,
            y: y * spacing,
            ox: x * spacing,
            oy: y * spacing,
            vx: 0,
            vy: 0
        });
    }
}

// ===== INTERAÇÃO =====
let pointer = {
    x: -9999,
    y: -9999,
    active: false
};

// Mouse
window.addEventListener("mousemove", e => {
    pointer.x = e.clientX;
    pointer.y = e.clientY;
    pointer.active = true;
});

window.addEventListener("mouseleave", () => {
    pointer.active = false;
});

// Touch (CELULAR)
window.addEventListener("touchstart", e => {
    const t = e.touches[0];
    pointer.x = t.clientX;
    pointer.y = t.clientY;
    pointer.active = true;
}, { passive: false });

window.addEventListener("touchmove", e => {
    e.preventDefault(); // ESSENCIAL
    const t = e.touches[0];
    pointer.x = t.clientX;
    pointer.y = t.clientY;
}, { passive: false });

window.addEventListener("touchend", () => {
    pointer.active = false;
});

// ===== ANIMAÇÃO =====
function animate() {
    ctx.clearRect(0, 0, w, h);

    for (const p of points) {
        let dx = p.x - pointer.x;
        let dy = p.y - pointer.y;
        let dist = Math.sqrt(dx * dx + dy * dy);

        if (pointer.active && dist < 120) {
            let force = (120 - dist) * 0.15;
            let angle = Math.atan2(dy, dx);
            p.vx += Math.cos(angle) * force;
            p.vy += Math.sin(angle) * force;
        }

        // física do tecido
        p.vx += (p.ox - p.x) * 0.02;
        p.vy += (p.oy - p.y) * 0.02;

        p.vx *= 0.85;
        p.vy *= 0.85;

        p.x += p.vx;
        p.y += p.vy;

        ctx.beginPath();
        ctx.arc(p.x, p.y, 1.5, 0, Math.PI * 2);
        ctx.fillStyle = "#00f0ff";
        ctx.fill();
    }

    requestAnimationFrame(animate);
}

animate();
</script>

</body>
</html>
