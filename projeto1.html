<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>Tecido Vivo</title>

<style>
  * {
    margin: 0;
    padding: 0;
    overflow: hidden;
    background: #000;
    touch-action: none;
  }
  canvas {
    display: block;
  }
</style>
</head>

<body>
<canvas id="fabric"></canvas>

<script>
/* ======================
   TECIDO — COLAPSO GRADUAL
====================== */

const canvas = document.getElementById("fabric");
const ctx = canvas.getContext("2d");

let points = [];
const spacing = 18;

let pointer = {
  x: 0,
  y: 0,
  active: false
};

function resize() {
  canvas.width = innerWidth;
  canvas.height = innerHeight;
  createGrid();
}
window.addEventListener("resize", resize);

/* ===== GRID ===== */
function createGrid() {
  points = [];
  for (let y = 0; y < canvas.height; y += spacing) {
    for (let x = 0; x < canvas.width; x += spacing) {
      points.push({
        x, y,
        ox: x, oy: y,
        vx: 0, vy: 0
      });
    }
  }
}

/* ===== INPUT ===== */
function setPointer(x, y, state) {
  pointer.x = x;
  pointer.y = y;
  pointer.active = state;
}

canvas.addEventListener("mousedown", e =>
  setPointer(e.clientX, e.clientY, true)
);
canvas.addEventListener("mousemove", e => {
  pointer.x = e.clientX;
  pointer.y = e.clientY;
});
canvas.addEventListener("mouseup", () => pointer.active = false);
canvas.addEventListener("mouseleave", () => pointer.active = false);

canvas.addEventListener("touchstart", e => {
  const t = e.touches[0];
  setPointer(t.clientX, t.clientY, true);
});
canvas.addEventListener("touchmove", e => {
  const t = e.touches[0];
  pointer.x = t.clientX;
  pointer.y = t.clientY;
});
canvas.addEventListener("touchend", () => pointer.active = false);

/* ===== ANIMAÇÃO ===== */
function animate() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);

  points.forEach(p => {

    // retorno elástico sempre ativo
    p.vx += (p.ox - p.x) * 0.025;
    p.vy += (p.oy - p.y) * 0.025;

    if (pointer.active) {
      const dx = pointer.x - p.x;
      const dy = pointer.y - p.y;
      const d = Math.hypot(dx, dy) || 1;

      const radius = 180; // raio de influência
      if (d < radius) {
        const force = (radius - d) / radius; // gradual
        p.vx += (dx / d) * force * 4;
        p.vy += (dy / d) * force * 4;
      }
    }

    // amortecimento suave
    p.vx *= 0.88;
    p.vy *= 0.88;

    p.x += p.vx;
    p.y += p.vy;

    ctx.fillStyle = "#4f9cff";
    ctx.fillRect(p.x, p.y, 2, 2);
  });

  requestAnimationFrame(animate);
}

/* ===== START ===== */
resize();
animate();
</script>
</body>
</html>
