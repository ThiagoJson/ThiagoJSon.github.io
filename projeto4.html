<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Tecido Colapsável — Thiago Martins</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
  *{margin:0;padding:0;overflow:hidden;background:#000;touch-action:none;}
  canvas{display:block;}
</style>
</head>
<body>
<canvas id="fabric4"></canvas>
<script>
const canvas = document.getElementById("fabric4");
const ctx = canvas.getContext("2d");

let points = [];
const spacing = 18;

let pointer = { x:0, y:0, active:false };

function resize(){
  canvas.width = innerWidth;
  canvas.height = innerHeight;
  points=[];
  for(let y=0;y<canvas.height;y+=spacing){
    for(let x=0;x<canvas.width;x+=spacing){
      points.push({x,y,ox:x,oy:y,vx:0,vy:0});
    }
  }
}
window.addEventListener("resize",resize);
resize();

/* INPUT */
canvas.addEventListener("mousemove", e => { pointer.x=e.clientX; pointer.y=e.clientY; pointer.active=true; });
canvas.addEventListener("mouseleave",()=>pointer.active=false);
canvas.addEventListener("touchstart",e=>{ const t=e.touches[0]; pointer.x=t.clientX; pointer.y=t.clientY; pointer.active=true; }, {passive:false});
canvas.addEventListener("touchmove",e=>{ const t=e.touches[0]; pointer.x=t.clientX; pointer.y=t.clientY; }, {passive:false});
canvas.addEventListener("touchend",()=>pointer.active=false);

/* ANIMAÇÃO */
function animate(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  for(const p of points){
    p.vx+=(p.ox-p.x)*0.025;
    p.vy+=(p.oy-p.y)*0.025;

    if(pointer.active){
      const dx = pointer.x - p.x;
      const dy = pointer.y - p.y;
      const d = Math.hypot(dx,dy)||1;
      const radius = 120;
      if(d<radius){
        const f=(radius-d)/radius;
        p.vx+=(dx/d)*f*3;
        p.vy+=(dy/d)*f*3;
      }
    }

    p.vx*=0.88;
    p.vy*=0.88;
    p.x+=p.vx;
    p.y+=p.vy;

    ctx.fillStyle="#ff6cff";
    ctx.fillRect(p.x,p.y,2,2);
  }
  requestAnimationFrame(animate);
}
animate();
</script>
</body>
</html>
